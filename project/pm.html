<!doctype html>
<html lang="en">
<head>
    <title>Antonio's Website</title>
    <link rel="stylesheet" href="../main.css" type="text/css">
    </head>
    <body class="animated">
        <div class="header">
    <div class="container">
    <div class="logo">
        <h1>Antonio's Website</h1>    
    </div>
    <div class="nav">
		<ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="smw.html">Super Mario World</a></li>
            <li><a href="pm.html">Paper Mario</a></li>
			<li><a href="archive.html">Archive</a></li>
        </ul>
    </div>
</div>
</div>
    <div class="container">
        <div class="content">
            <h1 class="center"><i>Paper Mario</i> Modding</h1>
            <hr />
            <h2>What is <i>Paper Mario</i>?</h2>
            <p><i>Paper Mario</i> is an ongoing series of action-adventure games by Nintendo. Each one features expansive overworld levels to explore, and interesting turn-based battles. Here, I'll be focusing on the modern trilogy of games:</p>
            <ul>
                <li><i>Sticker Star</i> (2012): Nintendo 3DS</li>
                <li><i>Color Splash</i> (2016): Wii U</li>
                <li><i>The Origami King</i> (2020): Nintendo Switch</li>
            </ul>
            <p>In this guide, I'll mostly be going over text modding. It's the only thing I'm sure of how to do for all of these games, and it's pretty easy to start with.</p>

            <p>I also have a very in-depth analysis on <i>Color Splash</i> that you can read <a href="cs.html">here</a>.</p>

            <p>Fast section links: <a href="pm.html#ss"><i>Sticker Star</i></a>, <a href="pm.html#cs"><i>Color Splash</i></a>, <a href="pm.html#tok"><i>The Origami King</i></a></p>
            <h2 id="ss"><i>Sticker Star</i> Modding</h2>
            <img src="./img/difficulty1-wordmark.png">
            <h3>What You'll Need</h3>
            <ul>
                <li>A decrypted copy of the game. Dump it from your own 3DS; the steps for this are outside the scope of this guide.</li>
                <li><a href="https://citra-emu.org/">Citra emulator</a>. For this mod, I used Citra Nightly 1705. Use the most recent version, it'll still work. It shouldn't matter whether you use Nightly or Canary.</li>
                <li><a href="https://github.com/IcySon55/Kuriimu/releases">Kuriimu</a>. This program lets you open and edit MSBT files, which you will need to do to replace the text.</li>
            </ul>
            <h3>The Guide</h3>
            <p>We'll be playing the game on Citra. You could play mods on a regular 3DS as well, but Citra works best for testing them.</p>
            <ol>
                <li>Get a fresh RomFS dump. You can do this from Citra by right clicking on the game and choosing "Dump RomFS".</li>
                <img src="./img/ss-romfs.png">
                <li>If you're on the USA release, the files can be found in <code>%APPDATA%\Citra\dump\romfs\00040000000A5E00</code>. Your folder should look like this:</li>
                <img src="./img/ss-rootfolders.png">
                <li>Navigate to <code>\messages\US_English</code>. You'll edit a different file depending on which level and part of the game you want to change the text in. See <b><a href="./pm-reference.html#ss">here</a></b> for a full reference sheet. For this tutorial, we'll do Surfshine Harbor, because it's both uniquely labeled and easily accessible from the start of the game. Its text file is <code>porttown_harbor.msbt</code>. <b>Make sure to back up any files before you edit them!</b></li>
                <img src="./img/ss-english.png">
                <li>You can change any text you want from here. Make sure the text is spaced and doesn't go outside of the text box; use the length of the original message as a guideline for how many characters long each line should be.</li>
                <img src="./img/ss-kuriimu.png">
                <li>You've changed your text, but where should it go now? It's time to create a mod directory. Go back to Citra's menu and right-click <i>Sticker Star</i>, then click "Open Mods Data", which should take you to <code>%APPDATA%\Citra\load\mods\00040000000A5E00\</code>. The code used for the game here is the same one as the dumped RomFS.</li>
                <li>Create a <code>\romfs</code> folder. Inside there, <b>everything should match the original dump's structure</b>.</li>
                <li>Create another <code>\messages\US_English</code> folder and drop your edited text file in there. Again, make sure it exactly matches the name of the original file.</li>
                <li>Play <i>Sticker Star</i> in Citra and get to the point where your text shows up. If it changed, congratulations! This guide worked!</li>
                <div class="row">
                <div class="column">
                    <img src="./img/ss-surfshine1.png" width="450px">
                    <figcaption>Original</figcaption>
                </div>
                <div class="column">
                    <img src="./img/ss-surfshine2.png" width="450px">
                    <figcaption>Modded</figcaption>
                </div>
                </div>
                <li>A quick note on disabling mods. The easiest way to do this is to rename the <code>romfs</code> folder inside <code>\load\mods</code>. This way, the file structure doesn't match up anymore, so the modded files won't be loaded. To load a mod again, rename the <code>romfs</code> folder back.</li>
            </ol>
            <h2 id="cs"><i>Color Splash</i> Modding</h2>
            <img src="./img/difficulty3-wordmark.png">
            <h3>What You'll Need</h3>
            <ul>
                <li>A decrypted copy of the game.</li>
                <li><a href="http://cemu.info/">Cemu emulator</a>. I used Cemu 1.22.13b, but anything afterwards will work too.</li>
                <li><a href="https://github.com/IcySon55/Kuriimu/releases">Kuriimu</a>. This game uses MSBTs, although compressed.</li>
                <li><a href="https://gbatemp.net/download/batchlz77.11736/">BatchLZ77</a>. This is what you'll be using to decompress and recompress the files.</li>
                <li><a href="https://mh-nexus.de/en/downloads.php?product=HxD20">HxD</a>. Any hex editor should work, but this is the one I like best.</li>
            </ul>
            <h3>The Guide</h3>
            <p><i>Color Splash</i> is a Wii U game, so start up Cemu. This is much more difficult than the other two games, but that's why I'm writing this guide in the first place.</p>
            <ol>
                <li>I'm using the Loadiine version, so there's no single ROM file to dump. You'll already have your game files, and you'll be editing them <b>directly</b>. Make sure to back up anything before you edit it!</li>
                <li>First, navigate to <code>content/messages/US_English_Final/</code>. You'll see your dialogue files here, but they're LZ77 type 11 compressed.</li>
                <img src="./img/cs-english.png">
                <li>For this tutorial, we'll be changing dialogue in the Green Energy Plant, which is <code>G3.msbt.lz</code>. See <b><a href="./pm-reference.html#cs">here</a></b> for a full list of what the files are. Notice the extra extension; this is a compressed file, which we'll have to decompress to edit. Open up HxD and drag the original file into it. HxD will automatically back up your files when you edit them, with the original recreated with a <code>.bak</code> extension.</li>
                <li>Highlight every byte <b>up to (but not including) 11</b> and copy them down for later. Then, delete them so that the file begins with the 11 byte. Save the file.</li>
                <img src="./img/cs-hxd.png">
                <li>Open <code>BatchLZ77.exe</code>. Decompress the file you've edited. This will create <code>G3.msbt.lz.decompressed</code>.</li>
                <img src="./img/cs-batchlz77.png">
                <li>You can now load the decompressed file into Kuriimu. Find the text you want and make edits to it. When you're done, save the file.</li>
                <img src="./img/cs-kuriimu.png">
                <li>Next, you'll need to recompress the file. Use BatchLZ77's compression on your edited decompressed file.</li>
                <li>Hex edit your newly compressed file. At the very beginning of the file, <b>paste in the bytes up to 11</b> that you initially removed. For this file, they're <code>A0 35 00 00 A0 35 00 00 13 A0 35 00</code>.</li>
                <li>Rename the file to <code>G3.msbt.lz</code> and put it directly in the file directory. It's okay to have backups in the same directory, but make sure they don't have the exact same filename and extension as your edited file.</li>
                <li>Get to the point where the text will display in-game. If you can make it past the level's loading screen, you're probably good. If the text changed, congratulations!</li>
                <div class="row">
                <div class="column">
                    <img src="./img/cs-plant1.png" width="450px">
                    <figcaption>Original</figcaption>
                </div>
                <div class="column">
                    <img src="./img/cs-plant2.png" width="450px">
                    <figcaption>Modded</figcaption>
                </div>
            </ol>
            <h2 id="tok"><i>The Origami King</i> Modding</h2>
            <img src="./img/difficulty1-wordmark.png">
            <h3>What You'll Need</h3>
            <ul>
                <li>A decrypted copy of the game.</li>
                <li><a href="https://yuzu-emu.org/downloads/">Yuzu emulator</a>. I used Yuzu 622 for this mod, but more recent versions should work as well.</li>
                <li><a href="https://github.com/IcySon55/Kuriimu/releases">Kuriimu</a>. This game uses MSBTs too.</li>
            </ul>
            <h3>The Guide</h3>
            <p><i>The Origami King</i> is a Switch exclusive, so we'll be playing it on Yuzu.</p>
            <ol>
                <li>Get a fresh RomFS dump. Right click the game in Yuzu and click "Dump RomFS".</li>
                <img src="./img/tok-romfs.png">
                <li>Unlike with Citra, you'll be presented with another popup. This asks if you want a full RomFS dump, with game files, or just the directory structure. Choose "Full" and wait until the dump is complete.</li>
                <img src="./img/tok-romfspopup.png">
                <li>You can find your game file dump in <code>%APPDATA%\yuzu\dump\0100A3900C3E2000\romfs\</code>. It should look like this:</li>
                <img src="./img/tok-rootfolders.png">
                <li>Navigate to <code>\msg\US_English_Final</code> for the dialogue files. It should look like this:</li>
                <img src="./img/tok-english.png">
                <li>I've charted what each MSBT file is and what it contains <b><a href="./pm-reference.html#tok">here</a></b>. For now, let's start by editing Overlook Tower, an early-game area that doesn't have much text. Unlike in <i>Sticker Star</i> and <i>Color Splash</i>, the lines are not labeled with the character who speaks them. However, they're placed in roughly descending order that they appear in-game. Open up <code>W1C4.msbt</code> and make any edits you want. Make sure to back it up, first!</li>
                <img src="./img/tok-kuriimu.png">
                <li>As with <i>Sticker Star</i>, you need to place this in a mod directory. Right-click the game in Yuzu's menu and click "Open Mod Data Location"; the exact file path is <code>%APPDATA%\yuzu\load\0100A3900C3E2000</code>. However, first, you'll need to give your mod a name. Create a folder named after the mod. You can have multiple mods at once.</li>
                <img src="./img/tok-modfolders.png">
                <li>After that, create a <code>\romfs</code> folder inside. Here, <b>everything should match the original dump's structure</b>. Create another <code>\msg\US_English_Final</code> and then put your edited MSBT file in there.</li>
                <li>Next, load your mod. Right click the game in Yuzu and click "Properties". Under the "Add-Ons" tab, you'll see a list of mods, named after their folders. Make sure the one you want to use is checked. This means that, when the file is loaded in the original game, it will replace it with the one from your mod directory.</li>
                <img src="./img/tok-modmenu.png">
                <li>Play <i>The Origami King</i> in Yuzu and get to the point where your text shows up. If it changed, congratulations! This guide worked!</li>
                <div class="row">
                <div class="column">
                    <img src="./img/tok-overlook1.png" width="450px">
                    <figcaption>Original</figcaption>
                </div>
                <div class="column">
                    <img src="./img/tok-overlook2.png" width="450px">
                    <figcaption>Modded</figcaption>
                </div>
                </div>
                <li>To disable mods, just uncheck them in the "Properties" menu. For more about Yuzu mod support, check out <a href="https://yuzu-emu.org/help/feature/game-modding/">the Yuzu website</a>.</li>
            </ol>
            </div>
        </div>
    </body>
</html>